<!DOCTYPE html>
<html>

  <head>
    <script src="https://download.affectiva.com/js/3.2/affdex.js"></script>
    <style>
    </style>
  </head>

  <body>
    <div id='video'></div>
    <div id='demo'></div>
  </body>

  <audio id="alarm">
      <source src="alarm.mp3" type="audio/mpeg">
  </audio>

  <script>

    window.onload = function() {

      const videoWidth = 640, videoHeight = 480
      const faceMode = affdex.FaceDetectorMode.LARGE_FACES

      const detector = new affdex.CameraDetector(
        document.querySelector('#video'),
        videoWidth, videoHeight, faceMode
      )

      detector.detectExpressions.eyeClosure=true
      currentExpression = null
      expressionLength = 0

      setInterval(incrementTime, 1000);
      var secondsPassed = 0;
      var prevSecondsPassed = 0;

      function incrementTime() {
        secondsPassed++;
      }

      var myArray = new Array();
      myArray[0] = 'You should go on a walk.';
      myArray[1] = 'You probably need to go get some food.';
      myArray[2] = 'Hi, I think you should drink some water.';
      myArray[3] = 'You may want to call your favorite parent.';
      myArray[4] = 'You should take a nap.';
      myArray[5] = 'Maybe you should watch a funny video.';

      detector.addEventListener( 'onImageResultsSuccess', function( faces ) {
        if( faces.length > 0 && secondsPassed > prevSecondsPassed) {
          prevSecondsPassed = secondsPassed;

          if(faces[0].expressions.eyeClosure > 70) {
            currentExpression = 7;
            expressionLength++;
            if(expressionLength==3) {

                var sound = document.getElementById("alarm");
                alarm.play();
                console.log(alarm.duration);

                var r = confirm("Were you almost asleep?");

                if (r==true) {
                    x=myArray[Math.floor((Math.random()*5))];
                    alarm.pause();
                }
                else {
                    x="thanks!";
                    alarm.pause();
                }
                document.getElementById("demo").innerHTML=x;
            }
          }
          else
          {
            currentExpression = 4;
            expressionLength = 0;
            //document.getElementById("demo").innerHTML = "You are fine";
          }


          console.log(faces)

        }
      })

      detector.start()
    }
  </script>
</html>